name: CI

on:
  pull_request:
    branches:
      - main
      - develop

  workflow_dispatch:

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    # services:
    #   mongo:
    #     image: mongo:6.0
    #     ports:
    #       - 27017:27017
    #     options: >-
    #       --health-cmd="mongosh --eval 'db.adminCommand(\"ping\")'" 
    #       --health-interval=10s 
    #       --health-timeout=5s 
    #       --health-retries=5

    steps:
      - name: Checkout source code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # checkout full history!

      # - name: Use Node.js
      #   uses: actions/setup-node@v4
      #   with:
      #     node-version: '22'
      #     cache: 'npm'

      # - name: Install dependencies
      #   run: npm ci

      # - name: Run Linter
      #   run: npm run lint

      # - name: Run Tests
      #   env:
      #     GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY || 'dummy-key-for-ci' }}
      #     MONGO_URL: mongodb://localhost:27017/hirebot_db
      #     CI: true
      #   run: npm run test

      - name: Push to GitLab
        run: |
          git config --global user.name "tranthethang"
          git config --global user.email "tranthethang@gmail.com"
          git remote add gitlab https://oauth2:${{ secrets.GITLAB_TOKEN }}@gitlab.com/tranthethang/hirebot-ai-api.git
          git push --all gitlab
          git push --tags gitlab
